# 电商项目@微商城litemall



## 商品管理模块面试题

- 你能解释一下什么是sku和spu吗？

  spu是商品的公共信息，sku是商品的规格信息。比如一个华为手机，spu是鸿蒙系统，骁龙的cpu，4000毫安的电池，6.5寸的屏幕等等。

  但是这部手机的颜色和容量是有很多种规格的，假设有三种颜色和三种容量，就有九种规格。关系：spu：skun = 1：n

- 如果删除spu记录，sku记录怎么处理

  如果是物理删除，在删除spu记录之前，先判断spu是否有关联的订单，如果有关联的订单，那么spu记录是不可以删除的。如果没有关联的订单是可以删除spu记录的，spu删除要连带着sku记录。

  如果是软删除，就不需要spu是否存在关联的订单了。可以软删除，同时要软删除关联的sku记录。

- 你做的电商系统是单商铺的还是多商铺的

  做的是B2C模式的，也就是单商铺的模式。如果是多商铺的C2C电商系统，商铺之间的数据是要隔离的。不能交叉访问，所以设计数据表的时候，需要引入商铺表，让spu关联到商铺（商铺ID），这样每个商铺就只能看到自己商铺的数据了

- 如何避免客户投诉的时候商家随意篡改信息

  虽然做的是单商铺的电商系统，只要商家编辑商品就生成新的商品记录，当用户根据订单查询商品，并不会查询到最新的商品记录，而是查询到下单时的商品记录。单商家的商品量不会有成千上万的数据，如果是C2C的，这样会保存大量的数据（spu、sku）。超过两千万数据，mysql的读写性能就会很差，应该单独创建spu、sku的归档数据表（历史表）；把归档数据转移到归档数据表里；这样就能实现对spu、sku表的缩表，这种设计交冷热数据分离。

- 删除商品记录用逻辑是删除，还是软删除（逻辑删除）

  软删除

- 怎么提高商品信息的加载速度

- 提高前端的渲染速度有很多种优化方案，首先是数据库方面，可以优化sql语句，多利用索引，设置innodb缓冲池，增加数据库的线程数量；数据库连接池方面增加连接数量，如果是小型项目，可以使用mysql分区技术。把数据切分存储到不同的硬盘上。多块硬盘的io优于单块，mysql的读写速度就可以提升了。如果是大型项目，数据库要使用集群。数据要做分库分表，要做数据的读写分离。冷热数据分离。后台也可以改进，如引入缓存，如果命中缓存就不需要走数据库了。后台项目的网络连接方式可以由bio优化至nio，依靠少量的线程就可以处理更多的网络请求。增加tomcat线程数量，提高网络吞吐能力，也可以对tomcat添加负载均衡，增加后台项目的负载能力。另外，可以使用cdn服务，缓存静态的网页和图片，这样浏览器加载商品信息也能更快一些。前端方面也能做些优化，比如减少http请求，能合并的请求合并为一个请求，素材图片可以使用雪花图，商品图片可以使用延时加载的方法。

- 你的电商系统是否支持顾客使用商品参数查找商品？

  规格参数（sku），如床垫，1.5m床垫*1，带有特殊符号等，或者带有json格式的数据，使用like模糊查询效率低，可以使用es来应对。可以在录入商品时，把商品同步到es，参数，商品名称，id写到es中，拿到id，在去数据库查询，最后渲染在页面上。

- 既然用到了es，那么sku还有什么实际意义吗

  es不能替代sku数据表，虽然es检索数据优于mysql，但是es不存放商品的全部信息；只是存放被检索的作为查询条件的信息；页面渲染详细的sku信息需要读取sku表中的信息。

- 如果用户查询“最好看的全面屏手机”，你应该怎么实现呢？

  es中ik中分分词器可以进行语义分析，“最好看的全面屏手机”，可能没有任何产品或参数是这样的，通过中文分词技术，提取关键词，忽略形容词。即“全面屏手机”，这样就能检索到信息了。

- 存放商品图片你用的是什么图床？

  腾讯云的对象存储服务。开通对象存储服务，后台系统配置appkey appid，设置存储桶，后台调用腾讯云提供的api接口，就可以把图片上传到云端了。

  

  

  

## 订单管理模块面试题

- 你能讲一下订单的生成流程吗？

拥有团购、优惠卷、购物积分等功能。在微信小程序下了订单，后台首先要做的是数据验证，然后做内容验证。假如有人用postman模拟提交数据，有的数据能通过后台的正则表达式验证，但是逻辑上是有问题的。比如优惠卷的id在数据库中不存在。这样的订单是绝对不能生成的。所以我们要通过数据库来验证ajax提交过来的数据是否逻辑有效。特别是优惠卷，团购都是有明确期限的。所以还需要验证团购、优惠卷是否已经过期了。然后后台计算商品的总价格，然后计算团购的减免金额，优惠卷的金额，还有积分的金额，有了这些数据，接下来后台就可以结算订单价格了。
$$
订单价格 = 商品总价格 - 团购减免的金额 - 优惠卷金额 - 积分金额
$$

$$
实际付款金额 = 订单价格 + 邮费（包邮条件：满88元包邮，即邮费 0元）
$$

用户付款就行了。数据库添加订单信息之后，数据库将优惠卷的状态标记为已经使用，并且记录下来用户参加了哪项团购活动，根据用户的下单数量在扣减库存。然后跳转到支付页面，等待用户支付。

- 如果商品下架了，用户没有刷新页面就下单了。后台程序应该怎么处理？

生成订单的时候，首先要验证前台的数据格式。检查逻辑有效性，就拿下架的商品而言，生成订单时要验证商品是否存在，以及商品是否已经下架了。如果商品已经下架，订单是不能生成的。给前台返回状态码，前台告知（提升）用户商品已经下架了。

- 扣减库存是什么时候？订单取消后，怎么恢复库存？

最合适的扣库存应该是下订单之后，而不是用户付款成功之后。用户付款成功之后，就一定能买到商品。否则购物体验是比较糟糕的。如果用户取消订单，或者长时间不付款，也会自动取消订单，不管什么原因，只要取消订单，就会自动释放库存。这样，库存就恢复了。

- 扣减库存怎么保证幂等性？

幂等性：不论是一个人操作数据，还是多个人操作数据，最终的结果不能出现错误。

在高并发的场景下，扣减库存会出现错误。

三种方案：

方案一：数据库设置为串行化执行，缺点很明显，需要所有的事物串行化执行。严重影响了数据库的并发性。

方案二：对数据库的记录进行加锁，容易引发思索，不建议使用。

可以给数据表添加乐观锁。“version”字段，乐观锁，最优实现

- 怎么保证订单号不重复？

用了雪花算法生成订单号，雪花算法结合了时间戳，主机id，随机数来生成订单号。但是在高并发的情况下，还是容易生成相同的订单号，可以加长订单号的长度，避免重复。

- 订单号和流水号是不是一回事儿

订单号中包含时间戳，但是不会包含很多的业务信息。比如说商品是哪一个品类的，商品是液体还是固体，是不是易碎品，商品有什么样的仓库发货。走的是空运还是陆运，这些信息都可以记录到流水号里面。流水号记录了这些。电商平台的工作人员，看到发货单上的流水号，不用去系统查询，就能知道应该怎么打包商品，怎么发货。甚至可以将流水号发送给机器人，让机器人到指定货架取指定的商品。有了流水号之后，不需要查询数据库，降低了系统的负载，工作人员也好，机器人也好，都知道怎么去做。这就是流水号的作用了。而订单号是没有这个功能的。因为订单号是对外开放，如果在订单号中包含了货架的位置，对消费者来说没有任何的意义。所以订单号不应该 内部的业务逻辑；而流水号是对内开放的，所以要有对应的业务逻辑。

- 订单记录怎么引用收货人地址

订单记录不能引用收货地址的id，否则收货地址修改，之前所有的订单的收获地址也同时更新了。这个是不对的，以前的订单使用以前的收货地址。没有使用地址id，而是把收货地址保存在订单记录中。这样就不会收到用户修改地址的影响了。

- 订单表是怎么设计的？

订单模块用到了两张数据表，一个是订单表，一个是订单商品表。因为一个订单可以包含多个商品，所以这两张表的关系是一对多的。订单的价格，邮费，实付金额，优惠卷，团购，收货地址，发货信息，签收信息这些数据保存在订单表里面。订单包含的商品信息、规格信息、原始价格这样的数据保存在订单商品表里面。如果一个订单买了十个不同的商品，那么订单商品表里面就存储这十个商品记录。不能直接使用spu、sku表的id，否则商家修改了商品信息，订单里的商品也就变了。所以是把商品信息复制到订单商品表。

- 你的电商项目有没有用到订单拆分功能？

可以按照仓库来拆分订单，A仓库发货的形成一个，B仓库发货的形成另外一个。

如果最近的仓库没有货，需要根据地理坐标位置来计算最近的发货仓库，而且运费还需要是最便宜。

- 能说说订单取消的形式吗

  取消订单场景：顾客发起。

  客服、卖家代为取消订单。

  系统自动取消订单。





































todo

5-5  介绍

5-6  介绍

 6-7  设计
